<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>{% block title %}Valltech - Estoque{% endblock %}</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='base.css') }}">
  <link rel="icon" href="{{ url_for('static', filename='assets/favicon.ico') }}" type="image/x-icon">
  <link rel="icon" type="image/png" sizes="32x32" href="{{ url_for('static', filename='assets/favicon-32x32.png') }}">
  <link rel="icon" type="image/png" sizes="16x16" href="{{ url_for('static', filename='assets/favicon-16x16.png') }}">
  <link rel="apple-touch-icon" sizes="180x180" href="{{ url_for('static', filename='assets/apple-touch-icon.png') }}">
  {% block extra_css %}{% endblock %}
</head>
<body>
  <button class="sidebar-toggle" onclick="toggleSidebar()">☰</button>

  <aside class="sidebar">
    <div class="sidebar-header">
      <img src="{{ url_for('static', filename='assets/logo-branca.png') }}" alt="Logo Valltech">
    </div>
    <nav class="item-menu">
      <div class="menu-section">
        <a href="{{ url_for('movimentacoes.listar_movimentacoes') }}"><i class="fas fa-list"></i> Histórico</a>
      </div>
      <div class="item-menu">
        <a href="{{ url_for('movimentacoes.nova_movimentacao') }}"><i class="fas fa-plus-circle"></i> Cadastrar Retirada</a>
      </div>
      <div class="menu-section">
        <button class="menu-toggle"><i class="fas fa-boxes"></i> Materiais <span class="arrow">▼</span></button>
        <div class="submenu">
          <a href="{{ url_for('listar_materiais') }}"><i class="fas fa-boxes"></i> Materiais</a>
          <a href="{{ url_for('novo_material') }}"><i class="fas fa-box"></i> Novo Material</a>
        </div>
      </div>
      <div class="menu-section">
        <button class="menu-toggle"><i class="fas fa-users"></i> Usuários <span class="arrow">▼</span></button>
        <div class="submenu">
          <a href="{{ url_for('listar_usuarios') }}"><i class="fas fa-users"></i> Usuários</a>
          <a href="{{ url_for('novo_usuario') }}"><i class="fas fa-user-plus"></i> Novo Usuário</a>
        </div>
      </div>
      <div class="menu-section">
        <button class="menu-toggle"><i class="fas fa-address-book"></i> Clientes <span class="arrow">▼</span></button>
        <div class="submenu">
          <a href="{{ url_for('clientes.listar_clientes') }}"><i class="fas fa-address-book"></i> Clientes</a>
          <a href="{{ url_for('clientes.novo_cliente') }}"><i class="fas fa-user-tie"></i> Novo Cliente</a>
        </div>
      </div>
    </nav>
    <div class="logout-wrapper">
      <a href="{{ url_for('logout') }}" class="logout-link"><i class="fas fa-sign-out-alt"></i> Logout</a>
    </div>
  </aside>

  <main class="main-content">
    {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
    <div class="flash-messages">
      {% for category, message in messages %}
      <div class="flash-message {{ category }}">{{ message }}</div>
      {% endfor %}
    </div>
    {% endif %}
    {% endwith %}

    {% block content %}{% endblock %}
  </main>

  <script>
    setTimeout(() => {
      document.querySelectorAll('.flash-message').forEach(el => {
        el.style.transition = 'opacity 0.5s ease';
        el.style.opacity = '0';
        setTimeout(() => el.remove(), 500);
      });
    }, 5000);

    document.querySelectorAll('.menu-toggle').forEach(toggle => {
      toggle.addEventListener('click', () => {
        const section = toggle.closest('.menu-section');
        section.classList.toggle('open');
      });
    });

    function toggleSidebar() {
      const sidebar = document.querySelector('.sidebar');
      const body = document.body;
      sidebar.classList.toggle('collapsed');
      body.classList.toggle('sidebar-collapsed');
    }
  </script>
</body>
</html>
